{% extends "base/base.html" %}
{% block start %}

<link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Vazirmatn', sans-serif;
    direction: rtl;
  }
  .filter-section {
    margin-bottom: 20px;
  }
  .form-group {
    margin-bottom: 10px;
  }
  .btn-primary {
    background-color: #0066cc;
    border-color: #0066cc;
  }
  .btn-primary:hover {
    background-color: #004d99;
    border-color: #004d99;
  }
  .card {
    border-radius: 8px;
    box-shadow: 0 0.15rem 1.75rem 0 rgb(33 40 50 / 15%);
  }
  @keyframes appear {
    from {
      opacity: 0;
      scale: 0.5;
    }
    to {
      opacity: 1;
      scale: 1;
    }
  }
  .card {
    animation: appear linear;
    animation-timeline: view();
    animation-range: entry 0% cover 40%;
  }
</style>

<div class="container mt-3 pt-3">
  {% include 'base/alert.html' %}
  <!-- Filter Section -->
  <div class="filter-section mb-3">
    <form method="GET" class="row">
      <div class="form-group col-md-6">
        <label for="category">دسته‌بندی:</label>
        <select id="category" name="category" class="form-control" onchange="this.form.submit()">
          <option value="">همه</option>
          {% for category in categories %}
          <option value="{{ category.category_name }}" {% if selected_category == category.category_name %} selected {% endif %}>
            {{ category.category_name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group col-md-6">
        <label for="sort">مرتب‌سازی بر اساس:</label>
        <select id="sort" name="sort" class="form-control" onchange="this.form.submit()">
          <option value="">انتخاب کنید</option>
          <option value="newest" {% if selected_sort == 'newest' %}selected{% endif %}>جدیدترین</option>
          <option value="priceAsc" {% if selected_sort == 'priceAsc' %}selected{% endif %}>قیمت: کم به زیاد</option>
          <option value="priceDesc" {% if selected_sort == 'priceDesc' %}selected{% endif %}>قیمت: زیاد به کم</option>
        </select>
      </div>
    </form>
  </div>

  <div class="row">
    {% for product in products %}
    <div class="col-md-3">
      <figure class="card card-product-grid">
        <div class="img-wrap">
          <img src="/media/{{product.product_images.first.image}}" />
        </div>
        <figcaption class="info-wrap border-top">
          <a href="{% url 'get_product' product.slug %}" class="title">
            <b>{{ product.product_name }}</b></a>
          <div class="price mt-2">{{ product.price }} ریال</div>
        </figcaption>
      </figure>
    </div>
    {% endfor %}
  </div>

  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center mb-4">
      {% if products.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ products.previous_page_number }}" aria-label="Previous">
          <span aria-hidden="true">قبلی</span>
        </a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <a class="page-link">قبلی</a>
      </li>
      {% endif %}

      {% for num in products.paginator.page_range %}
      <li class="page-item {% if products.number == num %}active{% endif %}">
        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
      </li>
      {% endfor %}

      {% if products.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ products.next_page_number }}" aria-label="Next">
          <span aria-hidden="true">بعدی</span>
        </a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <a class="page-link">بعدی</a>
      </li>
      {% endif %}
    </ul>
  </nav>
</div>

{% endblock %}